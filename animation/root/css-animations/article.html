<h1 id="css-动画">CSS 动画</h1>
<p>CSS 动画可以在不借助 Javascript 的情况下做出一些简单的动画效果。</p>
<p>你也可以通过 Javascript 控制 CSS 动画，使用少量的代码，就能让动画表现更加出色。</p>
<h2 id="css-过渡（transition）css-transition">CSS 过渡（transition）[#css-transition]</h2>
<p>CSS 过渡的理念非常简单，我们只需要定义某一个属性以及如何动态地表现其变化。当属性变化时，浏览器将会绘制出相应的过渡动画。</p>
<p>也就是说：我们只需要改变某个属性，然后所有流畅的动画都由浏览器生成。</p>
<p>举个例子，以下 CSS 会为 <code>backgroud-color</code> 的变化生成一个 3 秒的过渡动画：</p>
<pre><code class="language-css"><span class="hljs-selector-class">.animated</span> {
  <span class="hljs-attribute">transition-property</span>: background-color;
  <span class="hljs-attribute">transition-duration</span>: <span class="hljs-number">3s</span>;
}</code></pre>
<p>现在，只要一个元素拥有名为 <code>.animated</code> 的类，那么任何背景颜色的变化都会被渲染为 3 秒钟的动画。</p>
<p>单击以下按钮以演示动画：</p>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;color&quot;</span>&gt;</span>Click me<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
  <span class="hljs-selector-id">#color</span> {
    <span class="hljs-attribute">transition-property</span>: background-color;
    <span class="hljs-attribute">transition-duration</span>: <span class="hljs-number">3s</span>;
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  color.onclick = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-built_in">this</span>.style.backgroundColor = <span class="hljs-string">&#x27;red&#x27;</span>;
  };
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre>
<p>CSS 提供了四个属性来描述一个过渡：</p>
<ul>
<li><code>transition-property</code></li>
<li><code>transition-duration</code></li>
<li><code>transition-timing-function</code></li>
<li><code>transition-delay</code></li>
</ul>
<p>之后我们会详细介绍它们，目前我们需要知道，我们可以在 <code>transition</code> 中以 <code>property duration timing-function delay</code> 的顺序一次性定义它们，并且可以同时为多个属性设置过渡动画。</p>
<p>请看以下例子，点击按钮生成 <code>color</code> 和 <code>font-size</code> 的过渡动画：</p>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;growing&quot;</span>&gt;</span>Click me<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span>
#growing {
*!*
  transition: font-size 3s, color 2s;
*/!*
}
<span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
growing.onclick = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-built_in">this</span>.style.fontSize = <span class="hljs-string">&#x27;36px&#x27;</span>;
  <span class="hljs-built_in">this</span>.style.color = <span class="hljs-string">&#x27;red&#x27;</span>;
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre>
<p>现在让我们一个一个展开看这些属性。</p>
<h2 id="transition-property">transition-property</h2>
<p>在 <code>transition-property</code> 中我们可以列举要设置动画的所有属性，如：<code>left、margin-left、height 和 color</code>。</p>
<p>不是所有的 CSS 属性都可以使用过渡动画，但是它们中的<a href="http://www.w3.org/TR/css3-transitions/#animatable-properties-">大多数</a>都是可以的。<code>all</code> 表示应用在所有属性上。</p>
<h2 id="transition-duration">transition-duration</h2>
<p><code>transition-duration</code> 允许我们指定动画持续的时间。时间的格式参照 <a href="http://www.w3.org/TR/css3-values/#time">CSS 时间格式</a>：单位为秒 <code>s</code> 或者毫秒 <code>ms</code>。</p>
<h2 id="transition-delay">transition-delay</h2>
<p><code>transition-delay</code> 允许我们设定动画<strong>开始前</strong>的延迟时间。例如，对于 <code>transition-delay: 1s</code>，动画将会在属性变化发生 1 秒后开始渲染。</p>
<p>你也可以提供一个负值。那么动画将会从整个过渡的中间时刻开始渲染。例如，对于 <code>transition-duration: 2s</code>，同时把 <code>delay</code> 设置为 <code>-1s</code>，那么这个动画将会持续 1 秒钟，并且从正中间开始渲染。</p>
<p>这里演示了数字从 <code>0</code> 到 <code>9</code> 的动画，使用了 CSS <code>translate</code> 方法：</p>
<p>[codetabs src=&quot;digits&quot;]</p>
<p>如下在 <code>tranform</code> 属性上应用动画：</p>
<pre><code class="language-css"><span class="hljs-selector-id">#stripe</span><span class="hljs-selector-class">.animate</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate</span>(-<span class="hljs-number">90%</span>);
  <span class="hljs-attribute">transition-property</span>: transform;
  <span class="hljs-attribute">transition-duration</span>: <span class="hljs-number">9s</span>;
}</code></pre>
<p>在以上的例子中，JavaScript 把 <code>.animate</code> 类添加到了元素上，由此触发了动画：</p>
<pre><code class="language-js">stripe.classList.add(<span class="hljs-string">&#x27;animate&#x27;</span>);</code></pre>
<p>我们也可以『从中间』开始，也就是说从某个特定数字开始，比方说，从当前的时间的秒数开始。这就要用到负的 <code>transition-delay</code>。</p>
<p>此处，如果你单击这个数字，那么它会从当前的秒数开始渲染：</p>
<p>[codetabs src=&quot;digits-negative-delay&quot;]</p>
<p>只需添加一行 JavaScript 代码：</p>
<pre><code class="language-js">stripe.onclick = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">let</span> sec = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getSeconds() % <span class="hljs-number">10</span>;
*!*
  <span class="hljs-comment">// for instance, -3s here starts the animation from the 3rd second</span>
  stripe.style.transitionDelay = <span class="hljs-string">&#x27;-&#x27;</span> + sec + <span class="hljs-string">&#x27;s&#x27;</span>;
*/!*
  stripe.classList.add(<span class="hljs-string">&#x27;animate&#x27;</span>);
};</code></pre>
<h2 id="transition-timing-function">transition-timing-function</h2>
<p>时间函数描述了动画进程在时间上的分布。它是先慢后快还是先快后慢？</p>
<p>乍一看，这可能是最复杂的属性了，但是稍微花点时间，你就会发现其实也很简单。</p>
<p>这个属性接受两种值：一个贝塞尔曲线（Bezier curve）或者阶跃函数（steps）。我们先从贝塞尔曲线开始，这也是较为常用的。</p>
<h3 id="贝塞尔曲线（bezier-curve）">贝塞尔曲线（Bezier curve）</h3>
<p>时间函数可以用<a href="/bezier-curve">贝塞尔曲线</a>描述，通过设置四个满足以下条件的控制点：</p>
<ol>
<li>第一个应为：<code>(0,0)</code>。</li>
<li>最后一个应为：<code>(1,1)</code>。</li>
<li>对于中间值，<code>x</code> 必须位于 <code>0..1</code> 之间，<code>y</code> 可以为任意值。</li>
</ol>
<p>CSS 中设置一贝塞尔曲线的语法为：<code>cubic-bezier(x2, y2, x3, y3)</code>。这里我们只需要设置第二个和第三个值，因为第一个点固定为 <code>(0,0)</code>，第四个点固定为 <code>(1,1)</code>。</p>
<p>时间函数描述了动画进行的快慢。</p>
<ul>
<li><code>x</code> 轴表示时间：<code>0</code> —— 开始时刻，<code>1</code> —— <code>transition-duration</code>的结束时刻。</li>
<li><code>y</code> 轴表示过程的完成度：<code>0</code> —— 属性的起始值，<code>1</code> —— 属性的最终值。</li>
</ul>
<p>最简单的一种情况就是动画匀速进行，可以通过设置曲线为 <code>cubic-bezier(0, 0, 1, 1)</code> 来实现。</p>
<p>看上去就像这样：</p>
<p><img src="bezier-linear.svg" alt=""></p>
<p>...正如我们所见，这就是条直线。随着时间 <code>x</code> 推移，完成度 <code>y</code> 稳步从 <code>0</code> 增长到 <code>1</code>。</p>
<p>例子中的列车匀速地从左侧移动到右侧：</p>
<p>[codetabs src=&quot;train-linear&quot;]</p>
<p>这个里面的 CSS 就是基于刚才那条曲线的：</p>
<pre><code class="language-css"><span class="hljs-selector-class">.train</span> {
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">transition</span>: left <span class="hljs-number">5s</span> <span class="hljs-built_in">cubic-bezier</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
  <span class="hljs-comment">/* JavaScript sets left to 450px */</span>
}</code></pre>
<p>...那么，我们如果表现出减速行驶的列车呢？</p>
<p>我们可以使用另一条贝塞尔曲线：<code>cubic-bezier(0.0, 0.5, 0.5 ,1.0)</code>。</p>
<p>图像如下：</p>
<p><img src="train-curve.svg" alt=""></p>
<p>正如我们所见，这个过程起初很快：曲线开始迅速升高，然后越来越慢。</p>
<p>这是实际的效果演示：</p>
<p>[codetabs src=&quot;train&quot;]</p>
<p>CSS：</p>
<pre><code class="language-css"><span class="hljs-selector-class">.train</span> {
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">transition</span>: left <span class="hljs-number">5s</span> <span class="hljs-built_in">cubic-bezier</span>(<span class="hljs-number">0</span>, .<span class="hljs-number">5</span>, .<span class="hljs-number">5</span>, <span class="hljs-number">1</span>);
  <span class="hljs-comment">/* JavaScript sets left to 450px */</span>
}</code></pre>
<p>CSS 提供几条内置的曲线：<code>linear</code>、<code>ease</code>、<code>ease-in</code>、<code>ease-out</code> 和 <code>ease-in-out</code>。</p>
<p><code>linear</code> 其实就是 <code>cubic-bezier(0, 0, 1, 1)</code> 的简写 —— 一条直线，刚刚我们已经看过了。 </p>
<p>其它的名称是以下贝塞尔曲线的简写：</p>
<table>
<thead>
<tr>
<th><code>ease</code><sup>*</sup></th>
<th><code>ease-in</code></th>
<th><code>ease-out</code></th>
<th><code>ease-in-out</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>(0.25, 0.1, 0.25, 1.0)</code></td>
<td><code>(0.42, 0, 1.0, 1.0)</code></td>
<td><code>(0, 0, 0.58, 1.0)</code></td>
<td><code>(0.42, 0, 0.58, 1.0)</code></td>
</tr>
<tr>
<td><img src="ease.svg" alt="ease, figure"></td>
<td><img src="ease-in.svg" alt="ease-in, figure"></td>
<td><img src="ease-out.svg" alt="ease-out, figure"></td>
<td><img src="ease-in-out.svg" alt="ease-in-out, figure"></td>
</tr>
</tbody></table>
<p><code>*</code> —— 默认值，如果没有指定时间函数，那么将使用 <code>ease</code> 作为默认值。</p>
<p>所以，我们可以使用 <code>ease-out</code> 来表现减速行驶的列车：</p>
<pre><code class="language-css"><span class="hljs-selector-class">.train</span> {
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">transition</span>: left <span class="hljs-number">5s</span> ease-out;
  <span class="hljs-comment">/* transition: left 5s cubic-bezier(0, .5, .5, 1); */</span>
}</code></pre>
<p>但是这看起来有点怪怪的。</p>
<p><strong>贝塞尔曲线可以使动画『超出』其原本的范围。</strong></p>
<p>曲线上的控制点的 <code>y</code> 值可以使任意的：不管是负值还是一个很大的值。如此，贝塞尔曲线就会变得很低或者很高，让动画超出其正常的范围。</p>
<p>在一下的例子中使用的代码：</p>
<pre><code class="language-css"><span class="hljs-selector-class">.train</span> {
  <span class="hljs-attribute">left</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">transition</span>: left <span class="hljs-number">5s</span> <span class="hljs-built_in">cubic-bezier</span>(.<span class="hljs-number">5</span>, -<span class="hljs-number">1</span>, .<span class="hljs-number">5</span>, <span class="hljs-number">2</span>);
  <span class="hljs-comment">/* JavaScript sets left to 400px */</span>
}</code></pre>
<p><code>left</code> 本该在 <code>100px</code> 到 <code>400px</code> 之间变化。</p>
<p>但是如果你点击列车，你会发现：</p>
<ul>
<li>起初，列车会<strong>反向</strong>运动：<code>left</code> 会变得小于 <code>100px</code>。</li>
<li>然后，它会变回往前运动，并且超过 <code>400px</code>。</li>
<li>最后再返回 —— 回到 <code>400px</code>。</li>
</ul>
<p>[codetabs src=&quot;train-over&quot;]</p>
<p>为什么会这样？看一眼给定的贝塞尔曲线的图像你就会明白了。</p>
<p><img src="bezier-train-over.svg" alt=""></p>
<p>我们把第二个点的 <code>y</code> 坐标移动到了小于 <code>0</code> 的位置，同时把第三个点的 <code>y</code> 坐标移动到了大于 <code>1</code> 的位置，因此曲线已经不再像一个四分之一圆了。<code>y</code> 坐标超出了常规的 <code>0..1</code> 的范围。</p>
<p>正如我们所知，<code>y</code> 表示『动画进程的完成度』。<code>y = 0</code> 表示属性的初始值，<code>y = 1</code> 则表示属性的最终值。因此，<code>y &lt; 0</code> 意味着属性值要比初始值小，而 <code>y &gt; 1</code> 则表明属性值要比最终值大。</p>
<p>当然了，<code>-1</code> 和 <code>2</code> 还是比较缓和的值。如果我们把 <code>y</code> 设为 <code>-99</code> 和 <code>99</code>，那么列车将会偏离地更远。</p>
<p>但是，如何针对特定的任务寻找到合适的贝塞尔曲线呢？事实上，有很多工具可以帮到你。比方说，我们可以利用这个网站：<a href="http://cubic-bezier.com/">http://cubic-bezier.com/</a>。</p>
<h3 id="阶跃函数（steps）">阶跃函数（Steps）</h3>
<p>时间函数 <code>steps(number of steps[, start/end])</code> 允许你让动画分段进行，<code>number of steps</code> 表示需要拆分为多少段。</p>
<p>让我们通过一个数字的例子来演示一下。我们将会让数字以离散的方式变化，而不是以连续的方式。</p>
<p>为了达到效果，我们把动画拆分为 9 段：</p>
<pre><code class="language-css"><span class="hljs-selector-id">#stripe</span><span class="hljs-selector-class">.animate</span>  {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate</span>(-<span class="hljs-number">90%</span>);
  <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">9s</span> *!*<span class="hljs-built_in">steps</span>(<span class="hljs-number">9</span>, start)*/!*;
}</code></pre>
<p><code>step(9, start)</code> 生效时：</p>
<p>[codetabs src=&quot;step&quot;]</p>
<p><code>steps</code> 的第一个参数表示段数。这个过渡动画将会被拆分为 9 个部分（每个占 10%）。时间间隔也会以同样的方式被拆分：9 秒会被分割为多个时长 1 秒的间隔。</p>
<p>第二个参数可以取 <code>start</code> 或 <code>end</code> 两者其一。</p>
<p><code>start</code> 表示在动画开始时，我们需要立即开始第一段的动画。</p>
<p>可以观察到，在动画过程中：当我们单击数字之后，它会立马变为 <code>1</code>（即第一段），然后在下一秒开始的时候继续变化。</p>
<p>具体的流程如下：</p>
<ul>
<li><code>0s</code> —— <code>-10%</code>（在第一秒开始的时候立即变化）</li>
<li><code>1s</code> —— <code>-20%</code></li>
<li>...</li>
<li><code>8s</code> -- <code>-80%</code></li>
<li>（最后一秒，显示最终值）</li>
</ul>
<p>另一个值 <code>end</code> 表示：改变不应该在最开始的时候发生，而是发生在每一段的最后时刻。</p>
<p>其流程如下：</p>
<ul>
<li><code>0s</code> —— <code>0</code></li>
<li><code>1s</code> —— <code>-10%</code>（在第一秒结束时第一次变化）</li>
<li><code>2s</code> —— <code>-20%</code></li>
<li>...</li>
<li><code>9s</code> —— <code>-90%</code></li>
</ul>
<p><code>step(9, end)</code> 生效时：</p>
<p>[codetabs src=&quot;step-end&quot;]</p>
<p>另外还有一些简写值：</p>
<ul>
<li><code>step-start</code> —— 等同于 <code>steps(1, start)</code>。即：动画立刻开始，并且只有一段。也就是说，会立刻开始，紧接着就结束了，宛如没有动画一样。</li>
<li><code>step-end</code> —— 等同于 <code>steps(1, end)</code>。即：在 <code>transition-duration</code> 结束时生成一段动画。</li>
</ul>
<p>这些值很少会被用到，因为它们并不算是真正的动画，而是单步的变化。</p>
<h2 id="transitionend-事件">transitionend 事件</h2>
<p>CSS 动画完成后，会触发 <code>transitionend</code> 事件。</p>
<p>这被广泛用于在动画结束后执行某种操作。我们也可以用它来串联动画。</p>
<p>举例来说，下面的小船会在点击后向右浮动，然后再回来。而且，每一次都会向右移动地更远一点：</p>
<p>[iframe src=&quot;boat&quot; height=300 edit link]</p>
<p>这个动画通过 <code>go</code> 函数初始化，并且在每次动画完成后都会重复执行，并转变方向：</p>
<pre><code class="language-js">boat.onclick = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-comment">//...</span>
  <span class="hljs-keyword">let</span> times = <span class="hljs-number">1</span>;

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">go</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (times % <span class="hljs-number">2</span>) {
      <span class="hljs-comment">// 向右移动</span>
      boat.classList.remove(<span class="hljs-string">&#x27;back&#x27;</span>);
      boat.style.marginLeft = <span class="hljs-number">100</span> * times + <span class="hljs-number">200</span> + <span class="hljs-string">&#x27;px&#x27;</span>;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 向左移动</span>
      boat.classList.add(<span class="hljs-string">&#x27;back&#x27;</span>);
      boat.style.marginLeft = <span class="hljs-number">100</span> * times - <span class="hljs-number">200</span> + <span class="hljs-string">&#x27;px&#x27;</span>;
    }

  }

  go();

  boat.addEventListener(<span class="hljs-string">&#x27;transitionend&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    times++;
    go();
  });
};</code></pre>
<p><code>transitionend</code> 的事件对象有几个特定的属性：</p>
<p><code>event.propertyName</code>
：当前完成动画的属性，这在我们同时为多个属性加上动画时会很有用。</p>
<p><code>event.elapsedTime</code>
：动画完成的时间（按秒计算），不包括 <code>transition-delay</code>。</p>
<h2 id="关键帧动画（keyframes）">关键帧动画（Keyframes）</h2>
<p>我们可以通过 CSS 提供的 <code>@keyframes</code> 规则整合多个简单的动画。</p>
<p>它会指定某个动画的名称以及相应的规则：哪个属性，何时以及何地渲染动画。然后使用 <code>animation</code> 属性把动画绑定到相应的元素上，并为其添加额外的参数。</p>
<p>这里有个详细的例子：</p>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;progress&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span>
*!*
  @keyframes go-left-right {        /* 指定一个名字：&quot;go-left-right&quot; */
    from { left: 0px; }             /* 从 left: 0px 开始 */
    to { left: calc(100% - 50px); } /* 移动至 left: 100%-50px */
  }
*/!*

  .progress {
*!*
    animation: go-left-right 3s infinite alternate;
    /* 把动画 &quot;go-left-right&quot; 应用到元素上
       持续 3 秒
       持续次数：infinite
       每次都改变方向
    */
*/!*

    position: relative;
    border: 2px solid green;
    width: 50px;
    height: 20px;
    background: lime;
  }
<span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></code></pre>
<p>有许多关于 <code>@keyframes</code> 的文章以及一个<a href="https://drafts.csswg.org/css-animations/">详细的规范说明</a>。</p>
<p>很可能你并不需要经常用到 <code>@keyframes</code>，除非你的网站上有一直在运动的元素。</p>
<h2 id="总结">总结</h2>
<p>CSS 动画允许你为一个或者多个属性的变化创建丝滑流畅（也可能不是）的过渡动画。</p>
<p>它们适用于大多数的动画需求。我们也可以使用 JavaScript 创建动画，下一章将会详细讲解相关内容。</p>
<p>相对于 JavaScript 动画，CSS 动画存在的特点如下：</p>
<pre><code class="language-compare">+ 简单的事，简单地做。
+ 快速，而且对 CPU 造成的压力很小。
- JavaScript 动画更加灵活。它们可以实现任何动画逻辑，比如某个元素的爆炸效果。
- 不仅仅只是属性的变化。我们还可以在 JavaScript 中生成新元素用于动画。</code></pre>
<p>本节已经介绍了可以使用 CSS 实现的主要动画类型，而且 <code>transitionend</code> 还允许在动画结束后执行 JavaScript 代码，因此它可以方便得与代码结合起来。</p>
<p>但是在下一节，我们将会学习一些 JavaScript 动画来实现更加复杂的效果。</p>
