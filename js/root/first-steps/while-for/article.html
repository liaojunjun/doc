<h1 id="循环：while-和-for">循环：while 和 for</h1>
<p>我们经常需要重复执行一些操作。</p>
<p>例如，我们需要将列表中的商品逐个输出，或者运行相同的代码将数字 1 到 10 逐个输出。</p>
<p><strong>循环</strong> 是一种重复运行同一代码的方法。</p>
<h2 id="while-循环">&quot;while&quot; 循环</h2>
<p><code>while</code> 循环的语法如下：</p>
<pre><code class="language-js"><span class="hljs-keyword">while</span> (condition) {
  <span class="hljs-comment">// 代码</span>
  <span class="hljs-comment">// 所谓的“循环体” </span>
}</code></pre>
<p>当 <code>condition</code> 为 <code>true</code> 时，执行循环体的 <code>code</code>。</p>
<p>例如，以下将循环输出当 <code>i &lt; 3</code> 时的 <code>i</code> 值：</p>
<pre><code class="language-js"><span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>;
<span class="hljs-keyword">while</span> (i &lt; <span class="hljs-number">3</span>) { <span class="hljs-comment">// 依次显示 0、1 和 2</span>
  alert( i );
  i++;
}</code></pre>
<p>循环体的单次执行叫作 <strong>一次迭代</strong>。上面示例中的循环进行了三次迭代。</p>
<p>如果上述示例中没有 <code>i++</code>，那么循环（理论上）会永远重复执行下去。实际上，浏览器提供了阻止这种循环的方法，我们可以通过终止进程，来停掉服务器端的 JavaScript。</p>
<p>任何表达式或变量都可以是循环条件，而不仅仅是比较。在 <code>while</code> 中的循环条件会被计算，计算结果会被转化为布尔值。</p>
<p>例如，<code>while (i != 0)</code> 可简写为 <code>while (i)</code>：</p>
<pre><code class="language-js"><span class="hljs-keyword">let</span> i = <span class="hljs-number">3</span>;

<span class="hljs-keyword">while</span> (i) { <span class="hljs-comment">// 当 i 变成 0 时，条件为 false，循环终止</span>

  alert( i );
  i--;
}</code></pre>
<pre><code class="language-smart">如果循环体只有一条语句，则可以省略大括号 `{…}`：

```js
let i = 3;

while (i) alert(i--);

```</code></pre>
<h2 id="dowhile-循环">&quot;do..while&quot; 循环</h2>
<p>使用 <code>do..while</code> 语法可以将条件检查移至循环体 <strong>下面</strong>：</p>
<pre><code class="language-js"><span class="hljs-keyword">do</span> {
  <span class="hljs-comment">// 循环体</span>
} <span class="hljs-keyword">while</span> (condition);</code></pre>
<p>循环首先执行循环体，然后检查条件，当条件为真时，重复执行循环体。</p>
<p>例如：</p>
<pre><code class="language-js"><span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>;
<span class="hljs-keyword">do</span> {
  alert( i );
  i++;
} <span class="hljs-keyword">while</span> (i &lt; <span class="hljs-number">3</span>);</code></pre>
<p>这种形式的语法很少使用，除非你希望不管条件是否为真，循环体 <strong>至少执行一次</strong>。通常我们更倾向于使用另一个形式：<code>while(…) {…}</code>。</p>
<h2 id="for-循环">&quot;for&quot; 循环</h2>
<p><code>for</code> 循环更加复杂，但它是最常使用的循环形式。</p>
<p><code>for</code> 循环看起来就像这样：</p>
<pre><code class="language-js"><span class="hljs-keyword">for</span> (begin; condition; step) {
  <span class="hljs-comment">// ……循环体……</span>
}</code></pre>
<p>我们通过示例来了解一下这三个部分的含义。下述循环从 <code>i</code> 等于 <code>0</code> 到 <code>3</code>（但不包括 <code>3</code>）运行 <code>alert(i)</code>：</p>
<pre><code class="language-js"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) { <span class="hljs-comment">// 结果为 0、1、2</span>
  alert(i);
}</code></pre>
<p>我们逐个部分分析 <code>for</code> 循环：</p>
<table>
<thead>
<tr>
<th>语句段</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>begin</td>
<td><code>i = 0</code></td>
<td>进入循环时执行一次。</td>
</tr>
<tr>
<td>condition</td>
<td><code>i &lt; 3</code></td>
<td>在每次循环迭代之前检查，如果为 false，停止循环。</td>
</tr>
<tr>
<td>body（循环体）</td>
<td><code>alert(i)</code></td>
<td>条件为真时，重复运行。</td>
</tr>
<tr>
<td>step</td>
<td><code>i++</code></td>
<td>在每次循环体迭代后执行。</td>
</tr>
</tbody></table>
<p>一般循环算法的工作原理如下：</p>
<pre><code>开始运行
→ (如果 condition 成立 → 运行 body 然后运行 step)
→ (如果 condition 成立 → 运行 body 然后运行 step)
→ (如果 condition 成立 → 运行 body 然后运行 step)
→ ...</code></pre>
<p>所以，<code>begin</code> 执行一次，然后进行迭代：每次检查 <code>condition</code> 后，执行 <code>body</code> 和 <code>step</code>。</p>
<p>如果你这是第一次接触循环，那么回到这个例子，在一张纸上重现它逐步运行的过程，可能会对你有所帮助。</p>
<p>以下是在这个示例中发生的事：</p>
<pre><code class="language-js"><span class="hljs-comment">// for (let i = 0; i &lt; 3; i++) alert(i)</span>

<span class="hljs-comment">// 开始</span>
<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>
<span class="hljs-comment">// 如果条件为真，运行下一步</span>
<span class="hljs-keyword">if</span> (i &lt; <span class="hljs-number">3</span>) { alert(i); i++ }
<span class="hljs-comment">// 如果条件为真，运行下一步</span>
<span class="hljs-keyword">if</span> (i &lt; <span class="hljs-number">3</span>) { alert(i); i++ }
<span class="hljs-comment">// 如果条件为真，运行下一步</span>
<span class="hljs-keyword">if</span> (i &lt; <span class="hljs-number">3</span>) { alert(i); i++ }
<span class="hljs-comment">// ……结束，因为现在 i == 3</span></code></pre>
<pre><code class="language-smart">这里“计数”变量 `i` 是在循环中声明的。这叫做“内联”变量声明。这样的变量只在循环中可见。

```js
for (let i = 0; i &lt; 3; i++) {
  alert(i); // 0, 1, 2
}
alert(i); // 错误，没有这个变量。
```

除了定义一个变量，我们也可以使用现有的变量：

```js
let i = 0;

for (i = 0; i &lt; 3; i++) { // 使用现有的变量
  alert(i); // 0, 1, 2
}

alert(i); //3，可见，因为是在循环之外声明的
```
</code></pre>
<h3 id="省略语句段">省略语句段</h3>
<p><code>for</code> 循环的任何语句段都可以被省略。</p>
<p>例如，如果我们在循环开始时不需要做任何事，我们就可以省略 <code>begin</code> 语句段。</p>
<p>就像这样：</p>
<pre><code class="language-js"><span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; <span class="hljs-comment">// 我们已经声明了 i 并对它进行了赋值</span>

<span class="hljs-keyword">for</span> (; i &lt; <span class="hljs-number">3</span>; i++) { <span class="hljs-comment">// 不再需要 &quot;begin&quot; 语句段</span>
  alert( i ); <span class="hljs-comment">// 0, 1, 2</span>
}</code></pre>
<p>我们也可以移除 <code>step</code> 语句段：</p>
<pre><code class="language-js"><span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>;

<span class="hljs-keyword">for</span> (; i &lt; <span class="hljs-number">3</span>;) {
  alert( i++ );
}</code></pre>
<p>该循环与 <code>while (i &lt; 3)</code> 等价。</p>
<p>实际上我们可以删除所有内容，从而创建一个无限循环：</p>
<pre><code class="language-js"><span class="hljs-keyword">for</span> (;;) {
  <span class="hljs-comment">// 无限循环</span>
}</code></pre>
<p>请注意 <code>for</code> 的两个 <code>;</code> 必须存在，否则会出现语法错误。</p>
<h2 id="跳出循环">跳出循环</h2>
<p>通常条件为假时，循环会终止。</p>
<p>但我们随时都可以使用 <code>break</code> 指令强制退出。</p>
<p>例如，下面这个循环要求用户输入一系列数字，在输入的内容不是数字时“终止”循环。</p>
<pre><code class="language-js"><span class="hljs-keyword">let</span> sum = <span class="hljs-number">0</span>;

<span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {

  <span class="hljs-keyword">let</span> value = +prompt(<span class="hljs-string">&quot;Enter a number&quot;</span>, <span class="hljs-string">&#x27;&#x27;</span>);


  <span class="hljs-keyword">if</span> (!value) <span class="hljs-keyword">break</span>; <span class="hljs-comment">// (*)</span>


  sum += value;

}
alert( <span class="hljs-string">&#x27;Sum: &#x27;</span> + sum );</code></pre>
<p>如果用户输入空行或取消输入，在 <code>(*)</code> 行的 <code>break</code> 指令会被激活。它立刻终止循环，将控制权传递给循环后的第一行，即，<code>alert</code>。</p>
<p>根据需要，&quot;无限循环 + <code>break</code>&quot; 的组合非常适用于不必在循环开始/结束时检查条件，但需要在中间甚至是主体的多个位置进行条件检查的情况。</p>
<h2 id="继续下一次迭代-continue">继续下一次迭代 [#continue]</h2>
<p><code>continue</code> 指令是 <code>break</code> 的“轻量版”。它不会停掉整个循环。而是停止当前这一次迭代，并强制启动新一轮循环（如果条件允许的话）。</p>
<p>如果我们完成了当前的迭代，并且希望继续执行下一次迭代，我们就可以使用它。</p>
<p>下面这个循环使用 <code>continue</code> 来只输出奇数：</p>
<pre><code class="language-js"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {

  <span class="hljs-comment">//如果为真，跳过循环体的剩余部分。</span>
  <span class="hljs-keyword">if</span> (i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) <span class="hljs-keyword">continue</span>;

  alert(i); <span class="hljs-comment">// 1，然后 3，5，7，9</span>
}</code></pre>
<p>对于偶数的 <code>i</code> 值，<code>continue</code> 指令会停止本次循环的继续执行，将控制权传递给下一次 <code>for</code> 循环的迭代（使用下一个数字）。因此 <code>alert</code> 仅被奇数值调用。</p>
<p>````smart header=&quot;<code>continue</code> 指令利于减少嵌套&quot;
显示奇数的循环可以像下面这样：</p>
<pre><code class="language-js"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {

  <span class="hljs-keyword">if</span> (i % <span class="hljs-number">2</span>) {
    alert( i );
  }

}</code></pre>
<p>从技术角度看，它与上一个示例完全相同。当然，我们可以将代码包装在 <code>if</code> 块而不使用 <code>continue</code>。</p>
<p>但在副作用方面，它多创建了一层嵌套（大括号内的 <code>alert</code> 调用）。如果 <code>if</code> 中代码有多行，则可能会降低代码整体的可读性。</p>
<pre><code>
`&quot;禁止 `break/continue` 在 ‘?’ 的右边&quot;
请注意非表达式的语法结构不能与三元运算符 `?` 一起使用。特别是 `break/continue` 这样的指令是不允许这样使用的。

例如，我们使用如下代码：

```js
if (i &gt; 5) {
  alert(i);
} else {
  continue;
}
```

……用问号重写：


```js no-beautify
(i &gt; 5) ? alert(i) : continue; // continue 不允许在这个位置
```

……代码会停止运行，并显示有语法错误。

这是不（建议）使用问号 `?` 运算符替代 `if` 语句的另一个原因。</code></pre>
<h2 id="breakcontinue-标签">break/continue 标签</h2>
<p>有时候我们需要从一次从多层嵌套的循环中跳出来。</p>
<p>例如，下述代码中我们的循环使用了 <code>i</code> 和 <code>j</code>，从 <code>(0,0)</code> 到 <code>(3,3)</code> 提示坐标 <code>(i, j)</code>：</p>
<pre><code class="language-js"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) {

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">3</span>; j++) {

    <span class="hljs-keyword">let</span> input = prompt(<span class="hljs-string">`Value at coords (<span class="hljs-subst">${i}</span>,<span class="hljs-subst">${j}</span>)`</span>, <span class="hljs-string">&#x27;&#x27;</span>);

    <span class="hljs-comment">// 如果我想从这里退出并直接执行 alert(&#x27;Done!&#x27;)</span>
  }
}

alert(<span class="hljs-string">&#x27;Done!&#x27;</span>);</code></pre>
<p>我们需要提供一种方法，以在用户取消输入时来停止这个过程。</p>
<p>在 <code>input</code> 之后的普通 <code>break</code> 只会打破内部循环。这还不够 —— 标签可以实现这一功能！</p>
<p><strong>标签</strong> 是在循环之前带有冒号的标识符：</p>
<pre><code class="language-js">labelName: <span class="hljs-keyword">for</span> (...) {
  ...
}</code></pre>
<p><code>break &lt;labelName&gt;</code> 语句跳出循环至标签处：</p>
<pre><code class="language-js">outer: for (let i = 0; i &lt; 3; i++) {

  for (let j = 0; j &lt; 3; j++) {

    let input = prompt(`Value at coords (${i},${j})`, &#x27;&#x27;);

    // 如果是空字符串或被取消，则中断并跳出这两个循环。
    if (!input) break outer; // (*)

    // 用得到的值做些事……
  }
}
alert(&#x27;Done!&#x27;);</code></pre>
<p>上述代码中，<code>break outer</code> 向上寻找名为 <code>outer</code> 的标签并跳出当前循环。</p>
<p>因此，控制权直接从 <code>(*)</code> 转至 <code>alert(&#39;Done!&#39;)</code>。</p>
<p>我们还可以将标签移至单独一行：</p>
<pre><code class="language-js">outer:
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) { ... }</code></pre>
<p><code>continue</code> 指令也可以与标签一起使用。在这种情况下，执行跳转到标记循环的下一次迭代。</p>
<pre><code class="language-warn">标签不允许我们跳到代码的任意位置。

例如，这样做是不可能的：
```js
break label;  // 无法跳转到这个标签

label: for (...)
```

只有在循环内部才能调用 `break/continue`，并且标签必须位于指令上方的某个位置。 </code></pre>
<h2 id="总结">总结</h2>
<p>我们学习了三种循环：</p>
<ul>
<li><code>while</code> —— 每次迭代之前都要检查条件。</li>
<li><code>do..while</code> —— 每次迭代后都要检查条件。</li>
<li><code>for (;;)</code> —— 每次迭代之前都要检查条件，可以使用其他设置。</li>
</ul>
<p>通常使用 <code>while(true)</code> 来构造“无限”循环。这样的循环和其他循环一样，都可以通过 <code>break</code> 指令来终止。</p>
<p>如果我们不想在当前迭代中做任何事，并且想要转移至下一次迭代，那么可以使用 <code>continue</code> 指令。</p>
<p><code>break/continue</code> 支持循环前的标签。标签是 <code>break/continue</code> 跳出嵌套循环以转到外部的唯一方法。</p>
